<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="author" content="Pybonacci">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <title>Teor√≠a de control en Python con SciPy (II): Control PID | Pybonacci</title>

	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
        <link rel="alternate" type="application/atom+xml" title="Pybonacci blog atom feed" href="/feeds/all.atom.xml" />
        <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700' rel='stylesheet' type='text/css'>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="/theme/css/fontello.css"/>
        <style>.highlight .hll { background-color: #ffffcc }
.highlight .c { color: #60a0b0; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #007020; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #007020 } /* Comment.Preproc */
.highlight .c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
.highlight .cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #007020 } /* Keyword.Pseudo */
.highlight .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #902000 } /* Keyword.Type */
.highlight .m { color: #40a070 } /* Literal.Number */
.highlight .s { color: #4070a0 } /* Literal.String */
.highlight .na { color: #4070a0 } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #0e84b5; font-weight: bold } /* Name.Class */
.highlight .no { color: #60add5 } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #d55537; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #007020 } /* Name.Exception */
.highlight .nf { color: #06287e } /* Name.Function */
.highlight .nl { color: #002070; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #062873; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #bb60d5 } /* Name.Variable */
.highlight .ow { color: #007020; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #40a070 } /* Literal.Number.Float */
.highlight .mh { color: #40a070 } /* Literal.Number.Hex */
.highlight .mi { color: #40a070 } /* Literal.Number.Integer */
.highlight .mo { color: #40a070 } /* Literal.Number.Oct */
.highlight .sb { color: #4070a0 } /* Literal.String.Backtick */
.highlight .sc { color: #4070a0 } /* Literal.String.Char */
.highlight .sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #4070a0 } /* Literal.String.Double */
.highlight .se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #4070a0 } /* Literal.String.Heredoc */
.highlight .si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
.highlight .sx { color: #c65d09 } /* Literal.String.Other */
.highlight .sr { color: #235388 } /* Literal.String.Regex */
.highlight .s1 { color: #4070a0 } /* Literal.String.Single */
.highlight .ss { color: #517918 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #bb60d5 } /* Name.Variable.Class */
.highlight .vg { color: #bb60d5 } /* Name.Variable.Global */
.highlight .vi { color: #bb60d5 } /* Name.Variable.Instance */
.highlight .il { color: #40a070 } /* Literal.Number.Integer.Long */</style>
        <style>.description-author {
  font-size: 0.8em;
  color: #333;
}
.img-author {
  max-height: 10em;
  max-width: 10em;
}
img[src$="centerme"] {
  display: block;
  margin: 0 auto;
}
body {
  margin: 0;
  padding: 0;
  font: 'Source Sans Pro', sans-serif;
  color: #222222;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
}
@media all and (min-width: 960px) {
  body {
    font-size: 20px;
  }
}
@media all and (max-width: 959px) and (min-width: 600px) {
  body {
    font-size: 16px;
  }
}
@media all and (max-width: 599px) and (min-width: 320px) {
  body {
    font-size: 14px;
  }
}
div.input_area {
  font-size: 1.1em;
  margin: 0 10%;
}
div.output_area {
  font-size: 1.1em;
  margin: 0 10%;
}
div.output_subarea {
  max-width: 100% !important;
}
pre {
  font-size: 1.1em;
}
p {
  margin-bottom: 20px;
  line-height: 1.6em;
  text-align: justify;
}
img {
  display: block;
  margin-left: auto;
  margin-right: auto;
  max-width: 100%;
}
article {
  margin: 0;
}
article header.about {
  margin-bottom: 0px;
  padding-bottom: 0px;
}
article header {
  padding-bottom: 20px;
}
article header h1 {
  margin-bottom: 2px;
  font-weight: 700;
  color: #000;
}
article header time {
  color: #9E9E9E;
  float: right;
}
article header time.left {
  color: #9E9E9E;
  float: left;
}
article div.social-links ul {
  padding: 0px;
}
article div.social-links li {
  display: inline;
  font-size: 20px;
}
article div.social-links li a {
  color: #000;
  padding: 10px;
}
article div.social-links li a:hover {
  color: #666;
  text-decoration: none;
}
article p.note {
  background: #f5f5f5;
  border: 1px solid #ddd;
  padding: 0.533em 0.733em;
}
article p.update {
  background-color: #FEEFB3;
  border: 1px solid #e6e68a;
  padding: 0.533em 0.733em;
}
article p.alert {
  background-color: #ffe2e2;
  border: 1px solid #ffb2b2;
  padding: 0.533em 0.733em;
}
article a:hover {
  text-decoration: underline;
}
article blockquote {
  border-left: 2px solid #c7c7cc;
  color: #666;
  margin: 30px 0;
  padding: 0 0 0 25px;
}
article .meta {
  margin-top: 35px;
}
article .meta a:hover {
  text-decoration: none;
}
article .meta address:before,
article .meta time:before,
article .meta a.tag:before {
  font-family: 'fontello';
  margin-right: 6px;
}
article .meta address.author {
  float: left;
}
article .meta address:before {
  content: '\e819';
}
article .meta time:before {
  content: '\f133';
}
article .meta div.tags {
  clear: both;
}
article .meta a.tag {
  margin: 0 10px 10px 0;
  padding: 1px 12px;
  display: inline-block;
  font-size: 14px;
  color: rgba(0, 0, 0, 0.8);
  background: rgba(0, 0, 0, 0.05);
}
article .meta a.tag:before {
  content: '\e821';
}
article .meta a.tag:hover {
  background: rgba(0, 0, 0, 0.15);
}
article .meta a.read_more,
article .meta a.comments_btn {
  font-size: 1.5em;
  font-weight: 800;
  padding: 10px 20px;
  color: #007aa3;
  background: #FFF;
  border: 1px solid #007aa3;
}
article .meta a.read_more:hover,
article .meta a.comments_btn:hover {
  color: #FFF;
  background: #007aa3;
}
article .meta:after {
  content: "";
  display: table;
  clear: both;
}</style>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

        <script data-isso="https://comments.pybonacci.org"
                data-isso-lang="es"
                src="https://comments.pybonacci.org/js/embed.min.js"></script>

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        });
        MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML' async></script>


        </script>

    </head>

    <body>
        <header class="navbar navbar-default bs-docs-nav">
            <div class="container-fluid">
                <div class="navbar-header">
		  <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#theNavbar">
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span> 
		  </button>
                  <a class="navbar-brand" href="/" title="Home" class="title">Pybonacci</a><!-- ‚Äî Python y Ciencia-->
                </div>
                <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation" id="theNavbar">
		    <ul class="nav navbar-nav navbar-right">
                            <li><a href="/pages/acerca-de-pybonacci.html" title="About">Acerca de</a></li>
			    <li><a href="/pages/como-contribuir.html" title="Contributing">Contribuir</a></li>
                            <li><a href="/archives.html" title="Archive">Archivos</a></li>
                            <li><a class="nodec icon-rss" href="/feeds/all.atom.xml" title="pybonacci.github.io RSS feed" rel="me"></a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <div id="wrap">
<div class="container post">
    <article>
        <header>
            <h1>Teor√≠a de control en Python con SciPy (II): Control PID</h1>
            <div class="meta">
                <time datetime="article.date.isoformat()" pubdate>mi√© 06 noviembre 2013</time>
                <address class="vcard author">Por
                    <a class="url fn" href="http://pybonacci.github.io/author/juan-luis-cano.html">Juan Luis Cano</a>
                </address>
            </div>
        </header>

        <div class="article_content">
            <h2>Introducci√≥n</h2>
<p>En esta serie de art√≠culos vamos a estudiar <strong>c√≥mo podemos aplicar Python al estudio de la teor√≠a de control</strong>, en este caso utilizando SciPy. La teor√≠a de control se centra en los <strong>sistemas din√°micos</strong> con entradas: sistemas f√≠sicos cuyo estado evoluciona con el tiempo en funci√≥n de la informaci√≥n que reciben del exterior. Como puedes ver, esta definici√≥n es enormemente amplia: el control toca aspectos de la ingenier√≠a y de las matem√°ticas, y tiene aplicaciones tambi√©n en las ciencias sociales: psicolog√≠a, sociolog√≠a, finanzas...</p>
<ol>
<li><a href="https://pybonacci.org/2013/10/10/teoria-de-control-en-python-con-scipy-i/" title="Teor√≠a de control en Python con SciPy (I): Conceptos¬†b√°sicos">Conceptos b√°sicos</a></li>
<li><strong>Control PID</strong></li>
</ol>
<p>En esta segunda parte, una vez vistos algunos conceptos b√°sicos en la primera, vamos a retomar el problema del control de crucero del coche exactamente donde lo dejamos:</p>
<blockquote>
<p>La conclusi√≥n que podemos extraer de este gr√°fico es que <strong>para pasar de 0 a 100 km/h, nuestro coche necesita casi un minuto</strong>. ¬°Fatal! ¬øC√≥mo arreglamos esto? Aqu√≠ entra la belleza de la teor√≠a de control, pero lo vamos a dejar para la segunda parte üòâ</p>
</blockquote>
<p>A las referencias que ya recomend√© en la primera parte voy a a√±adir [Ogata, 2010], un excelente libro sobre ingenier√≠a de control traducido al espa√±ol por profesores de Espa√±a y Argentina. De ah√≠ he estudiado la parte matem√°tica del control PID y me he inspirado para las figuras. Cualquier aspecto te√≥rico se puede consultar en este libro.</p>
<p><em><strong>En esta entrada se han usado python 3.3.2, numpy 1.8.0, scipy 0.13.0 y matplotlib 1.3.0.</strong></em></p>
<h2>Concepto de realimentaci√≥n</h2>
<p>Si recordamos el modelo de nuestro coche, ten√≠amos un sistema con una entrada (la fuerza de tracci√≥n que genera el motor) y una salida o variable a controlar (la velocidad del coche). Este tipo de sistemas se denominan <strong>en lazo abierto</strong> y se pueden esquematizar con un diagrama de bloques de este estilo:</p>
<p style="text-align:center">
  <img class="aligncenter  wp-image-1943" alt="Lazo abierto" src="https://pybonacci.org/images/2013/11/open_loop.png" width="341" height="127" srcset="https://pybonacci.org/wp-content/uploads/2013/11/open_loop.png 568w, https://pybonacci.org/wp-content/uploads/2013/11/open_loop-300x111.png 300w" sizes="(max-width: 341px) 100vw, 341px" />
</p>

<p>En este caso la <strong>planta</strong> ser√≠a el motor y el <strong>controlador</strong> un sistema que consiguiese esa tracci√≥n constante que consideramos en la primera parte. Este tipo de sistemas son poco √∫tiles porque no podemos disponer de la informaci√≥n de la salida para controlar la entrada. No les prestaremos m√°s atenci√≥n.</p>
<p>Si queremos tener en cuenta las posibles perturbaciones de la salida deber√≠amos medirla continuamente para comprobar que cumple con nuestros requisitos. A esto se le denomina <strong>control en lazo cerrado</strong> y se puede esquematizar de la siguiente manera:</p>
<p style="text-align:center">
  <img class="aligncenter  wp-image-1947" alt="Lazo cerrado" src="https://pybonacci.org/images/2013/11/closed_loop1.png" width="420" height="187" srcset="https://pybonacci.org/wp-content/uploads/2013/11/closed_loop1.png 720w, https://pybonacci.org/wp-content/uploads/2013/11/closed_loop1-300x133.png 300w" sizes="(max-width: 420px) 100vw, 420px" />
</p>

<p>Ya vemos que se van complicando un poco las cosas. En este caso, la entrada de la planta la proporciona el <strong>actuador</strong>, y la entrada del actuador es <strong>la diferencia entre la se√±al de referencia y la salida</strong>. Esta diferencia se denomina se√±al <strong>error</strong> por razones obvias. Con este cambio de esquema y de filosof√≠a tenemos en cada instante informaci√≥n sobre la salida del sistema y podemos por tanto ajustar el control del mismo. Veamos un m√©todo para llevar a cabo este control.</p>
<!--more-->

<p>Comprob√°bamos con nuestro ejemplo del coche que el tiempo que necesitaba para pasar de 0 a 100 km/h era muy grande. Este tiempo se define como <strong>tiempo de subida</strong>, $t_r$ (<em>rising time</em> en ingl√©s): el tiempo requerido para que la respuesta pase del 0 % al 100 % de su valor final. Otros m√°rgenes utilizados son 5-95 % y 10-90 %. M√°s adelante, cuando empecemos a introducir oscilaciones, veremos otras definiciones similares.</p>
<h2>Control PID</h2>
<p>El control PID combina una acci√≥n <strong>proporcional</strong>, una <strong>integral</strong> y otra <strong>derivativa</strong> sobre la se√±al de error para dar la entrada de la planta. La ecuaci√≥n de un controlador de este tipo es:</p>
<p>$\displaystyle u(t) = K_p e(t) + K_i \int_0^t e(t) dt + K_d \frac{de(t)}{dt}$</p>
<p>y su funci√≥n de transferencia, por tanto:</p>
<p>$\displaystyle H(s) = \frac{U(s)}{E(s)} = K_p + \frac{K_i}{s} + K_d s$</p>
<p>Podemos escribir tambi√©n</p>
<p>$\displaystyle K_p + \frac{K_i}{s} + K_d s = K_p (1 + \frac{1}{T_i s} + T_d s)$</p>
<p>donde $T_i$ se denomina <em>tiempo integral</em> y $T_d$ es el <em>tiempo derivativo</em>.</p>
<p>Cada uno de estos t√©rminos contribuye de una forma distinta al sistema de control, y la correcta ponderaci√≥n de cada una de estas contribuciones es lo que tendremos que buscar para conseguir una soluci√≥n satisfactoria. Este proceso se llama <strong>sinton√≠a de controladores PID</strong> (<em>PID tuning</em>). Vamos a estudiarlos uno por uno.</p>
<h3>Proporcional</h3>
<p>Lo primero que se nos puede ocurrir es hacer que la se√±al de control $u(t)$ (la salida del actuador y la entrada de la planta) sea <strong>proporcional</strong> al error entre la salida y el valor de referencia. Recuperando la funci√≥n de transferencia de nuestro control de crucero, tendr√≠amos un esquema como el siguiente:<figure id="attachment_1951" style="width: 372px" class="wp-caption aligncenter"></p>
<p><img alt="proportional" src="https://pybonacci.org/images/2013/11/proportional.png"></p>
<p>N√≥tese que la naturaleza de nuestro sistema ha cambiado completamente: antes control√°bamos directamente la fuerza del motor, ahora indicamos una velocidad de referencia y el sistema ajusta dicha fuerza. La nueva funci√≥n de transferencia ser√°:</p>
<p>$\displaystyle \frac{Y(s)}{R(s)} = \frac{Y(s)}{Y(s) + E(s)} = \dots = \frac{K}{ms + b + K}$</p>
<p>SciPy no proporciona un modo directo de operar con bloques, de modo que vamos a escribir nuestras propias funciones a tal efecto. Para ello, operaremos las funciones de transferencia de los sistemas como fracciones, extrayendo por separado el numerador y el denominador y utilizando las funciones de NumPy <a href="http://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.polymul.html"><code>np.polymul</code></a> y <a href="http://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.polyadd.html"><code>np.polyadd</code></a>. Este ser√° el c√≥digo:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">series</span><span class="p">(</span><span class="n">sys1</span><span class="p">,</span> <span class="n">sys2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Series connection of two systems.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sys1</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">lti</span><span class="p">):</span>
        <span class="n">sys1</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lti</span><span class="p">(</span><span class="o">*</span><span class="n">sys1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sys2</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">lti</span><span class="p">):</span>
        <span class="n">sys2</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lti</span><span class="p">(</span><span class="o">*</span><span class="n">sys2</span><span class="p">)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polymul</span><span class="p">(</span><span class="n">sys1</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="n">sys2</span><span class="o">.</span><span class="n">num</span><span class="p">)</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polymul</span><span class="p">(</span><span class="n">sys1</span><span class="o">.</span><span class="n">den</span><span class="p">,</span> <span class="n">sys2</span><span class="o">.</span><span class="n">den</span><span class="p">)</span>
    <span class="n">sys</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lti</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sys</span>
<span class="k">def</span> <span class="nf">feedback</span><span class="p">(</span><span class="n">plant</span><span class="p">,</span> <span class="n">sensor</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Negative feedback connection of plant and sensor.</span>
<span class="sd">    If sensor is None, then it is assumed to be 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plant</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">lti</span><span class="p">):</span>
        <span class="n">plant</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lti</span><span class="p">(</span><span class="o">*</span><span class="n">plant</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sensor</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">sensor</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lti</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sensor</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">lti</span><span class="p">):</span>
        <span class="n">sensor</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lti</span><span class="p">(</span><span class="o">*</span><span class="n">sensor</span><span class="p">)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polymul</span><span class="p">(</span><span class="n">plant</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="n">sensor</span><span class="o">.</span><span class="n">den</span><span class="p">)</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyadd</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polymul</span><span class="p">(</span><span class="n">plant</span><span class="o">.</span><span class="n">den</span><span class="p">,</span> <span class="n">sensor</span><span class="o">.</span><span class="n">den</span><span class="p">),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">polymul</span><span class="p">(</span><span class="n">plant</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="n">sensor</span><span class="o">.</span><span class="n">num</span><span class="p">))</span>
    <span class="n">sys</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lti</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sys</span>
</pre></div>


<p>Echemos ahora un vistazo a la respuesta unitaria del sistema, seleccionando por ejemplo un valor de 200 para la ganancia, y veremos que tenemos ciertos problemas:</p>
<div class="highlight"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="mi">200</span>
<span class="c1"># Sistema controlador-planta</span>
<span class="n">sys_pc</span> <span class="o">=</span> <span class="n">series</span><span class="p">(([</span><span class="n">K</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">sys_car</span><span class="p">)</span>
<span class="c1"># Sistema realimentado</span>
<span class="n">sys_prop</span> <span class="o">=</span> <span class="n">feedback</span><span class="p">(</span><span class="n">sys_pc</span><span class="p">)</span>
<span class="c1"># Respuesta a entrada escal√≥n</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">step2</span><span class="p">(</span><span class="n">sys_prop</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
</pre></div>


<p style="text-align:center">
  <img class="aligncenter  wp-image-1953" alt="k200" src="https://pybonacci.org/images/2013/11/k200.png" width="315" height="226" srcset="https://pybonacci.org/wp-content/uploads/2013/11/k200.png 394w, https://pybonacci.org/wp-content/uploads/2013/11/k200-300x215.png 300w" sizes="(max-width: 315px) 100vw, 315px" />
</p>

<p>De acuerdo, ahora el tiempo de subida es de unos 20 segundos (en vez del minuto de antes) pero ¬°la salida <strong>no llega al nivel que queremos</strong>! Esto es as√≠ porque los controladores proporcionales introducen un cierto <strong>error en estado estacionario</strong> $e_{ss}$. Para nuestro sistema, el valor de este error ser√°:</p>
<p>$\displaystyle e_{ss} = \lim_{t \rightarrow \infty} e(t) = \frac{1}{1 + K / b}$</p>
<p>Parece l√≥gico pensar que entonces debemos aumentar la $K$ para reducir el error. Si hacemos esto, tendr√≠amos la siguiente respuesta:</p>
<p style="text-align:center">
  <img class="aligncenter  wp-image-1954" alt="k2000" src="https://pybonacci.org/images/2013/11/k2000.png" width="315" height="226" srcset="https://pybonacci.org/wp-content/uploads/2013/11/k2000.png 394w, https://pybonacci.org/wp-content/uploads/2013/11/k2000-300x215.png 300w" sizes="(max-width: 315px) 100vw, 315px" />
</p>

<p>Ahora el tiempo de subida es de menos de 5 segundos y el error de estado estacionario es $e_{ss} \simeq 3.6 %$. ¬øHemos conseguido ya lo que quer√≠amos? Sobre el papel s√≠, pero ¬øte has fijado en la pendiente de la curva en el punto inicial? <strong>No podemos</strong> aumentar indefinidamente la ganancia proporcional porque eso implica <strong>aumentar indefinidamente la fuerza</strong> del motor. Tenemos que buscar otros m√©todos.</p>
<h3>Integral</h3>
<p>La desventaja del control proporcional es que, si la se√±al de error tiende a cero, la se√±al de control tambi√©n. Con el t√©rmino integral podemos a√±adir una contribuci√≥n que depende del √°rea encerrada bajo la curva de la se√±al error, y por tanto <strong>eliminamos el error en estado estacionario</strong>. Ahora nuestro esquema quedar√≠a de la siguiente forma:<figure id="attachment_1957" style="width: 372px" class="wp-caption aligncenter"></p>
<p><img alt="Control PI" src="https://pybonacci.org/images/2013/11/pi.png"></p>
<p>Y la funci√≥n de transferencia ser√°:</p>
<p>$\displaystyle \frac{Y(s)}{R(s)} = \frac{K_p s + K_i}{m s^2 + (b + K_p) s + K_i}$</p>
<p>Exacto: hemos convertido el sistema <strong>en uno de segundo orden</strong>. Esto tendr√° algunos efectos nuevos, como se puede ver en la gr√°fica de la respuesta a escal√≥n unitario del sistema para $K_p = 200$ y $K_i = 50$:</p>
<div class="highlight"><pre><span></span><span class="n">K_p</span> <span class="o">=</span> <span class="mf">200.0</span>
<span class="n">K_i</span> <span class="o">=</span> <span class="mf">50.0</span>
<span class="c1"># Sistema controlador-planta</span>
<span class="n">sys_pc</span> <span class="o">=</span> <span class="n">series</span><span class="p">(([</span><span class="n">K_p</span><span class="p">,</span> <span class="n">K_i</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">sys_car</span><span class="p">)</span>
<span class="c1"># Sistema realimentado</span>
<span class="n">sys_prop</span> <span class="o">=</span> <span class="n">feedback</span><span class="p">(</span><span class="n">sys_pc</span><span class="p">)</span>
<span class="c1"># Respuesta a entrada escal√≥n</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">step2</span><span class="p">(</span><span class="n">sys_prop</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
</pre></div>


<p style="text-align:center">
  <img class="aligncenter  wp-image-1958" alt="Control PI" src="https://pybonacci.org/images/2013/11/kp200ki50.png" width="315" height="226" srcset="https://pybonacci.org/wp-content/uploads/2013/11/kp200ki50.png 394w, https://pybonacci.org/wp-content/uploads/2013/11/kp200ki50-300x215.png 300w" sizes="(max-width: 315px) 100vw, 315px" />
</p>

<p>Tenemos un tiempo de subida menor a 10 segundos, pero por contra <strong>hemos introducido una oscilaci√≥n en el sistema</strong>. En algunos problemas puede ser inadmisible, pero en este caso nos lo podemos permitir. Lo √∫nico que tenemos que hacer es controlar la oscilaci√≥n; para ello tenemos otras dos magnitudes interesantes:</p>
<ul>
<li>El <strong>tiempo de pico</strong> $t_p$ (<em>peak time</em>) definido como el tiempo requerido para que la respuesta llegue al primer m√°ximo.</li>
<li>La <strong>sobreelongaci√≥n m√°xima</strong> $M_p$ (<em>overshoot</em>) definida como el valor m√°ximo de la respuesta, por encima del resultado estacionario.</li>
</ul>
<p>En general, querremos ajustar nuestro sistema de control para que tenga:</p>
<ul>
<li>Tiempo de subida peque√±o,</li>
<li>sobreelongaci√≥n peque√±a, y</li>
<li>ausencia de error en estado estacionario.</li>
</ul>
<p>Una cuesti√≥n que hay que tener muy en cuenta es que <strong>no podemos optimizar estos tres requisitos a la vez</strong>. Si reducimos el tiempo de subida, la sobreelongaci√≥n m√°xima aumentar√°, y viceversa [Ogata, pp. 171].</p>
<p>Podemos marcar unos requisitos para nuestro caso concreto:</p>
<ul>
<li>Tiempo de subida &lt; 5 s</li>
<li>M√°xima sobreelongaci√≥n &lt; 10 %</li>
<li>Error en estado estacionario &lt; 2 %</li>
</ul>
<p>Vamos a escribir un par de peque√±as funciones que nos calculen estas magnitudes:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ys</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">margins</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Rise time.</span>
<span class="sd">    Other possible margins: (0.05, 0.95), (0.1, 0.9). If no ys is given,</span>
<span class="sd">    then last value of y is assumed as stationary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ys</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Values between margins[0] * ys and margins[1] * ys</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">margins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ys</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">margins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ys</span><span class="p">)</span>
    <span class="c1"># If response oscillates, only interested in limits of first region</span>
    <span class="n">idx_change</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">mask</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Initial and final indexes</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">idx_change</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">idx_change</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Time difference</span>
    <span class="k">return</span> <span class="n">t</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="k">def</span> <span class="nf">Ms</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ys</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Maximum overshoot.</span>
<span class="sd">    Other possible margins: (0.05, 0.95), (0.1, 0.9). If no ys is given,</span>
<span class="sd">    then last value of y is assumed as stationary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ys</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">Ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ys</span><span class="p">)</span> <span class="o">/</span> <span class="n">ys</span>
    <span class="k">return</span> <span class="n">Ms</span>
</pre></div>


<p>Se comprueba que para $K_p = 700$ y $K_i = 100$ cumplimos:</p>
<div class="highlight"><pre><span></span><span class="n">K_p</span> <span class="o">=</span> <span class="mf">700.0</span>
<span class="n">K_i</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="c1"># Sistema controlador-planta</span>
<span class="n">sys_pc</span> <span class="o">=</span> <span class="n">series</span><span class="p">(([</span><span class="n">K_p</span><span class="p">,</span> <span class="n">K_i</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">sys_car</span><span class="p">)</span>
<span class="c1"># Sistema realimentado</span>
<span class="n">sys_prop</span> <span class="o">=</span> <span class="n">feedback</span><span class="p">(</span><span class="n">sys_pc</span><span class="p">)</span>
<span class="c1"># Respuesta a entrada escal√≥n</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">step2</span><span class="p">(</span><span class="n">sys_prop</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Tiempo de subida: {:.2f} s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;M√°xima sobreelongaci√≥n: {:.1f} %&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Ms</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
<span class="c1"># Tiempo de subida: 4.22 s</span>
<span class="c1"># M√°xima sobreelongaci√≥n: 6.3 %</span>
</pre></div>


<p><img class="aligncenter size-full wp-image-1960" alt="Par√°metros finales de control PI" src="https://pybonacci.org/images/2013/11/kp700ki100.png" width="394" height="283" srcset="https://pybonacci.org/wp-content/uploads/2013/11/kp700ki100.png 394w, https://pybonacci.org/wp-content/uploads/2013/11/kp700ki100-300x215.png 300w" sizes="(max-width: 394px) 100vw, 394px" /></p>
<p>¬°Genial!</p>
<h3>Derivativo</h3>
<p>Ya hemos cumplido nuestros requisitos as√≠ que no tendr√≠amos porqu√© a√±adir un t√©rmino derivativo, y por tanto en este art√≠culo no lo vamos a estudiar en detalle. Este tendr√° como efecto <strong>suavizar</strong> la respuesta, aunque tiene una contrapartida importante: en presencia de ruido puede desestabilizar el sistema. El art√≠culo ya es demasiado largo y el an√°lisis es id√©ntico al efectuado anteriormente, as√≠ que se deja como ejercicio al lector üôÇ</p>
<h2>Otros m√©todos</h2>
<p>El control PID es ampliamente utilizado, especialmente para sistemas de los que desconocemos su funcionamiento interno (¬´cajas negras¬ª) y es relativamente simple. Sin embargo, sintonizar controladores PID puede ser m√°s complicado de lo que parece y en general no se consigue un control √≥ptimo. Existen otros m√©todos como el del <a href="http://es.wikipedia.org/wiki/Lugar_de_ra%C3%ADces">lugar de las ra√≠ces</a> o el estudio de la respuesta en frecuencia que son tambi√©n √∫tiles para dise√±ar sistemas de control. Pero de ellos ya hablaremos en entregas sucesivas, si el p√∫blico lo reclama üòâ</p>
<p>Espero que nos hag√°is llegar vuestros comentarios y sugerencias a trav√©s del formulario m√°s abajo y que os haya gustado el art√≠culo.</p>
<p>¬°Un saludo!</p>
<h2>Ap√©ndice: Estado del arte</h2>
<p>Aqu√≠ hemos visto que con Python hemos tenido que trabajar un poco m√°s de lo que tendr√≠amos que haber trabajado con MATLAB. Por un lado, hemos tenido que escribir nuestras propias funciones para operar con bloques, calcular tiempos de subida y sobreelongaciones... Y por otro lado, se echa en falta una interfaz gr√°fica con la que trabajar de una manera mucho m√°s intuitiva (los diagramas del art√≠culo est√°n hechos con Inkscape, y ha sido un poco laborioso). En este √°rea SciPy tiene a√∫n mucho que mejorar, y de hecho ya hay algunas ideas.</p>
<p>Implementar operaciones con sistemas LTI o crear una interfaz gr√°fica son tareas relativamente sencillas, pero requieren que alguien se ponga con ellas. Si alguno de nuestros lectores quiere dar un paso adelante, le animamos a que contacte con nosotros, haga un fork de SciPy y se ponga a trabajar. El ingl√©s no es un problema: podemos guiarle con el proceso en <a href="https://pybonacci.org/2013/08/23/informando-de-bugs-en-numpy-y-scipy-en-castellano-a-traves-de-pybonacci/" title="Informando de bugs en NumPy y SciPy en castellano a trav√©s de¬†Pybonacci">nuestro propio fork, como ya anunciamos hace unos meses</a>.</p>
<p>Como el t√≠tulo del art√≠culo deja bien claro que √≠bamos a usar SciPy, he descartado la biblioteca <a href="http://www.cds.caltech.edu/~murray/wiki/index.php/Python-control">python-control</a>. En muchos sentidos est√° m√°s avanzada que el paquete signal de SciPy <strong>y proporciona compatibilidad con MATLAB</strong>, pero no me queda claro si la est√°n manteniendo activamente o no, y por tanto no me he decidido a utilizarla. Por si alguien tiene curiosidad, aqu√≠ hay un <a href="http://www.cds.caltech.edu/~murray/wiki/index.php/Python-control/Example:_Vertical_takeoff_and_landing_aircraft">ejemplo analizando el sistema de despegue y aterrizaje de un avi√≥n</a>.</p>
<h2>Referencias</h2>
<ol>
<li>SEDRA, Adel S.; SMITH, Kenneth C. <em>Microelectronic circuits</em>. Oxford University Press, 2004.</li>
<li>MESSNER, Bill et al. <em>Control Tutorials for MATLAB and Simulink</em> [en l√≠nea]. 2011. Disponible en web: &lt;<a href="http://ctms.engin.umich.edu/">http://ctms.engin.umich.edu/</a>&gt;. [Consulta: 10 de octubre de 2013]</li>
<li>GIL, Jorge Juan; RUBIO, √Ångel. <em>Fundamentos de Control Autom√°tico de Sistemas Continuos y Muestreados</em>. Universidad de Navarra, 2009.</li>
<li>OGATA, Katsuhiko. <em>Ingenier√≠a de control moderna</em>. 5¬™ ed. Pearson, 2010.</li>
</ol>
        </div>

        <div class="meta">
            <div class="tags">
                    <a href="http://pybonacci.github.io/tag/control.html" class="tag">control</a>
                    <a href="http://pybonacci.github.io/tag/python.html" class="tag">python</a>
                    <a href="http://pybonacci.github.io/tag/python-3.html" class="tag">python 3</a>
                    <a href="http://pybonacci.github.io/tag/scipy.html" class="tag">scipy</a>
                    <a href="http://pybonacci.github.io/tag/scipysignal.html" class="tag">scipy.signal</a>
            </div>
        </div>


    </article>
<section id="isso-thread">
    <h3>Comentarios</h3>
</section>
</div>

<style type="text/css">
{
    max-width: 700px;
}

.text_cell .prompt {
    display: none;
}

div.cell {
    padding: 0;
}

div.text_cell_render {
    padding: 0;
}

div.prompt {
    font-size: 13px;
}

div.input_prompt {
    padding: .7em 0.2em;
}

div.output_prompt {
    padding: .4em .2em;
}

div.input_area {
}

table.dataframe {
    font-family: Arial, sans-serif;
    font-size: 13px;
    line-height: 20px;
}

table.dataframe th, td {
    padding: 4px;
    text-align: left;
}

pre code {
    background-color: inherit;
}</style>

        </div>

        <footer class="disclaimer">
          <div class="container-fluid">
            <p>
              ¬© 2012-2018 Pybonacci, licencia <a href="https://github.com/Pybonacci/pybonacci.github.io/blob/sources/LICENSE.md"> CC BY-SA 4.0 + MIT</a>
              salvo otra indicaci√≥n.
              <p>Contenido generado con <a href= "http://docs.getpelican.com/">Pelican</a>.</p>
            </p>
          </div>
        </footer>

    </body>
</html>